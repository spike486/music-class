<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤å…¸éŸ³ä¹é­”æ³•å±‹ (æœ€ç»ˆçè—ç‰ˆ)</title>
    <link href="https://fonts.googleapis.com/css2?family=Zcool+KuaiLe&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FFD54F;
            --secondary: #4DD0E1;
            --accent: #FF7043;
            --text: #37474F;
            --bg: #FAFAFA;
        }

        body {
            font-family: 'Zcool KuaiLe', cursive, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            user-select: none;
        }

        /* å¯¼èˆªæ  */
        header {
            background: #fff;
            padding: 10px 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 100;
            flex-shrink: 0;
        }

        .nav-btn {
            background: #f8f8f8;
            border: 2px solid #eee;
            padding: 8px 25px;
            border-radius: 50px;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #999;
        }

        .nav-btn:hover { background: #f0f0f0; }

        .nav-btn.active {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            background: var(--primary);
            color: #333;
            border-color: #333;
        }

        main {
            flex: 1;
            position: relative;
            background-image: radial-gradient(#e0e0e0 1px, transparent 1px);
            background-size: 20px 20px;
            overflow-y: auto; 
        }

        .scene {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            min-height: 100%; 
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            opacity: 0;
            transition: opacity 0.5s;
            padding-bottom: 40px;
        }

        .scene.active {
            display: flex;
            opacity: 1;
        }

        /* --- 1. å›å½’ç»å…¸ï¼šå¤§ Emoji å¤´åƒ --- */
        .avatar-emoji {
            font-size: 100px;
            margin-bottom: 10px;
            filter: drop-shadow(0 5px 0 rgba(0,0,0,0.1));
            animation: float 3s ease-in-out infinite;
            cursor: default;
            line-height: 1;
        }

        .stage-title {
            font-size: 36px;
            margin-bottom: 10px;
            color: #333;
            text-shadow: 2px 2px 0 #fff;
        }

        .instruction {
            font-size: 20px;
            color: #555;
            background: rgba(255,255,255,0.9);
            padding: 8px 20px;
            border-radius: 20px;
            margin-bottom: 25px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.1);
        }

        /* --- 2. å½±é™¢çº§è§†é¢‘æ¡†è®¾è®¡ (16:9) --- */
        .video-wrapper {
            margin-top: auto; /* æ²‰åº• */
            width: 90%;
            max-width: 640px; /* é™åˆ¶æœ€å¤§å®½åº¦ï¼Œä¿è¯ç²¾è‡´ */
            background: #222; /* æ·±è‰²åº•åº§ */
            padding: 12px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3); /* å¼ºçƒˆçš„ç«‹ä½“æŠ•å½± */
            border: 4px solid #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        
        /* è£…é¥°æ€§ï¼šé¡¶éƒ¨å°æ ‡ç­¾ */
        .video-wrapper::before {
            content: "ğŸ¬ æ¬£èµæ—¶é—´ï¼šSmalin å¯è§†åŒ–éŸ³ä¹";
            position: absolute;
            top: -15px;
            background: #FF7043;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        video {
            width: 100%;
            aspect-ratio: 16 / 9; /* é”å®š 16:9 æ¯”ä¾‹ */
            border-radius: 10px;
            background: #000;
            object-fit: contain; /* ç¡®ä¿ç”»é¢ä¸è¢«è£åˆ‡ */
            display: block;
        }

        /* --- åœºæ™¯äº’åŠ¨å…ƒç´ æ ·å¼ --- */
        
        /* æµ·é¡¿ */
        #scene-haydn { background-color: #E0F7FA; }
        .audience-container { display: flex; gap: 10px; font-size: 50px; margin-bottom: 20px; height: 60px; }
        .audience { transition: all 0.2s; }
        .audience.awake { transform: scale(1.5) translateY(-20px); }
        .meter-container { width: 300px; height: 30px; background: #ddd; border-radius: 15px; overflow: hidden; margin-bottom: 20px; border: 3px solid #fff; }
        .meter-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #4CAF50, #FFEB3B, #FF5722); transition: width 0.2s; }
        .conductor-controls { display: flex; gap: 30px; align-items: center; margin-bottom: 20px; }
        .baton-btn { width: 100px; height: 100px; border-radius: 50%; background: #81C784; border: none; font-size: 40px; cursor: pointer; box-shadow: 0 8px 0 #388E3C; position: relative; }
        .baton-btn:active { transform: translateY(5px); box-shadow: 0 3px 0 #388E3C; }
        .surprise-btn { width: 140px; height: 140px; border-radius: 50%; background: #ccc; border: none; font-size: 50px; color: white; cursor: not-allowed; box-shadow: 0 8px 0 #999; transition: all 0.3s; }
        .surprise-btn.ready { background: #F44336; cursor: pointer; box-shadow: 0 8px 0 #D32F2F; animation: pulse 1s infinite; }
        .surprise-btn.ready:active { transform: scale(0.95); }

        /* è«æ‰ç‰¹ */
        #scene-mozart { background-color: #F3E5F5; }
        .star-stage { width: 280px; height: 280px; background: #fff; border-radius: 20px; border: 5px solid #AB47BC; display: flex; justify-content: center; align-items: center; margin-bottom: 20px; position: relative; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .base-star { font-size: 140px; color: #FFD700; transition: all 0.5s; z-index: 1; line-height: 1; }
        .accessory { position: absolute; transition: all 0.5s; opacity: 0; transform: scale(0.5); }
        .accessory.visible { opacity: 1; transform: scale(1); }
        .acc-shoes { font-size: 60px; bottom: 20px; right: 20px; z-index: 2; }
        .acc-mask { font-size: 80px; top: 70px; z-index: 3; }
        .acc-crown { font-size: 80px; top: -30px; left: -20px; transform: rotate(-20deg); z-index: 4; }
        .wardrobe { display: flex; gap: 15px; margin-bottom: 20px; }
        .clothing-item { background: #fff; padding: 10px; border-radius: 15px; border: 3px solid #ddd; width: 80px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .clothing-item.equipped { border-color: #AB47BC; background: #E1BEE7; transform: translateY(-5px); }
        .clothing-item h4 { margin: 5px 0 0; font-size: 16px; }
        .clothing-item .icon { font-size: 30px; }

        /* è´å¤šèŠ¬ */
        #scene-beethoven { background-color: #E8F5E9; }
        .door-frame { width: 220px; height: 300px; background: #5D4037; border-radius: 15px 15px 0 0; position: relative; display: flex; flex-direction: column; align-items: center; padding-top: 40px; box-shadow: 10px 10px 0 rgba(0,0,0,0.2); cursor: pointer; }
        .door-inner { width: 180px; height: 260px; background: #8D6E63; border: 2px dashed #3E2723; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        .lion-reveal { position: absolute; font-size: 100px; display: none; animation: popIn 0.5s; }
        .lock-lights { display: flex; gap: 10px; margin-bottom: 20px; z-index: 2; }
        .light { width: 30px; height: 30px; border-radius: 50%; background: #3E2723; border: 2px solid #aaa; transition: all 0.2s; }
        .light.on { background: #FF5252; box-shadow: 0 0 10px #FF5252; border-color: #fff; }
        .light.success { background: #69F0AE; box-shadow: 0 0 15px #69F0AE; }
        .knocker { width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 10; }
        .rhythm-hint { margin-top: 15px; font-size: 24px; display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
        .hint-dot { width: 15px; height: 15px; background: #333; border-radius: 50%; }
        .hint-dash { width: 40px; height: 15px; background: #333; border-radius: 10px; }

        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.05);} 100% {transform: scale(1);} }
        @keyframes popIn { 0% {transform: scale(0);} 80% {transform: scale(1.2);} 100% {transform: scale(1);} }
        @keyframes float { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(-10px);} }

    </style>
</head>
<body>

<header>
    <div class="nav-btn active" onclick="switchScene('haydn')">ğŸ˜´ æµ·é¡¿</div>
    <div class="nav-btn" onclick="switchScene('mozart')">ğŸ‘— è«æ‰ç‰¹</div>
    <div class="nav-btn" onclick="switchScene('beethoven')">ğŸ¦ è´å¤šèŠ¬</div>
</header>

<main>
    <!-- åœºæ™¯1ï¼šæµ·é¡¿ -->
    <div id="scene-haydn" class="scene active">
        <!-- å½¢è±¡å›å½’ï¼šæµ·é¡¿çˆ·çˆ· -->
        <div class="avatar-emoji">ğŸ‘´</div>
        <div class="stage-title">æµ·é¡¿çˆ·çˆ·çš„æ¶ä½œå‰§</div>
        <div class="instruction">ä»»åŠ¡ï¼šè½»è½»ç‚¹ç»¿è‰²æŒ‡æŒ¥ï¼Œèƒ½é‡æ»¡äº†æŒ‰çº¢è‰²æŒ‰é’®ï¼</div>
        
        <div class="audience-container">
            <span class="audience">ğŸ˜´</span>
            <span class="audience">ğŸ˜´</span>
            <span class="audience">ğŸ˜´</span>
            <span class="audience">ğŸ˜´</span>
        </div>

        <div class="meter-container">
            <div id="haydn-meter" class="meter-fill"></div>
        </div>

        <div class="conductor-controls">
            <button class="baton-btn" onclick="tapSoftly()">
                ğŸ¼<br><span style="font-size:14px">è½»è½»çš„</span>
            </button>
            <button id="surprise-btn" class="surprise-btn" onclick="triggerSurprise()">
                ğŸ’¥<br><span style="font-size:16px">æƒŠæ„•!</span>
            </button>
        </div>

        <!-- å½±é™¢çº§è§†é¢‘æ¡† -->
        <div class="video-wrapper">
            <!-- æ’­æ”¾æœ¬åœ°æ–‡ä»¶ï¼šhaydn.mp4 -->
            <video controls>
                <source src="videos/haydn.mp4" type="video/mp4">
                è¯·å°† 'haydn.mp4' æ”¾å…¥åŒä¸€æ–‡ä»¶å¤¹ä»¥æ’­æ”¾è§†é¢‘
            </video>
        </div>
    </div>

    <!-- åœºæ™¯2ï¼šè«æ‰ç‰¹ -->
    <div id="scene-mozart" class="scene">
        <!-- å½¢è±¡å›å½’ï¼šè«æ‰ç‰¹å®å® -->
        <div class="avatar-emoji">ğŸ‘¶</div>
        <div class="stage-title">å°æ˜Ÿæ˜Ÿå˜è£…ç§€</div>
        <div class="instruction">ä»»åŠ¡ï¼šç‚¹å‡»è¡£æœï¼Œç»™å°æ˜Ÿæ˜Ÿç©¿ä¸Šä¸åŒçš„â€œå˜å¥â€ï¼</div>

        <div class="star-stage">
            <div id="main-star" class="base-star">â­</div>
            <div id="acc-shoes" class="accessory acc-shoes">ğŸ‘Ÿ</div>
            <div id="acc-mask" class="accessory acc-mask">ğŸ­</div>
            <div id="acc-crown" class="accessory acc-crown">ğŸ‘‘</div>
        </div>

        <div class="wardrobe">
            <div class="clothing-item" id="item-shoes" onclick="toggleOutfit('shoes')">
                <div class="icon">ğŸ‘Ÿ</div>
                <h4>è·‘é‹<br>(å¿«æ¿)</h4>
            </div>
            <div class="clothing-item" id="item-mask" onclick="toggleOutfit('mask')">
                <div class="icon">ğŸ­</div>
                <h4>é¢å…·<br>(å°è°ƒ)</h4>
            </div>
            <div class="clothing-item" id="item-crown" onclick="toggleOutfit('crown')">
                <div class="icon">ğŸ‘‘</div>
                <h4>çš‡å† <br>(åä¸½)</h4>
            </div>
        </div>

        <!-- å½±é™¢çº§è§†é¢‘æ¡† -->
        <div class="video-wrapper">
            <!-- æ’­æ”¾æœ¬åœ°æ–‡ä»¶ï¼šmozart.mp4 -->
            <video controls>
                <source src="videos/mozart.mp4" type="video/mp4">
                è¯·å°† 'mozart.mp4' æ”¾å…¥åŒä¸€æ–‡ä»¶å¤¹ä»¥æ’­æ”¾è§†é¢‘
            </video>
        </div>
    </div>

    <!-- åœºæ™¯3ï¼šè´å¤šèŠ¬ -->
    <div id="scene-beethoven" class="scene">
        <!-- å½¢è±¡å›å½’ï¼šè´å¤šèŠ¬ç‹®å­ -->
        <div class="avatar-emoji">ğŸ¦</div>
        <div class="stage-title">è´å¤šèŠ¬çš„å¯†ç é—¨</div>
        <div class="instruction">ä»»åŠ¡ï¼šæŒ‰â€œçŸ­-çŸ­-çŸ­-é•¿â€çš„èŠ‚å¥æ•²é—¨ï¼</div>

        <div class="lock-lights">
            <div id="light-1" class="light"></div>
            <div id="light-2" class="light"></div>
            <div id="light-3" class="light"></div>
            <div id="light-4" class="light"></div>
        </div>

        <div class="door-frame">
            <div class="door-inner">
                <div id="door-knocker" class="knocker" onclick="tapDoor()"></div>
                <div style="font-size: 80px; opacity: 0.2">ğŸšª</div>
                <div id="lion" class="lion-reveal">ğŸ¦</div>
            </div>
        </div>

        <div class="rhythm-hint">
            å¯†ç æç¤ºï¼š
            <div class="hint-dot"></div>
            <div class="hint-dot"></div>
            <div class="hint-dot"></div>
            <div class="hint-dash"></div>
        </div>

        <!-- å½±é™¢çº§è§†é¢‘æ¡† -->
        <div class="video-wrapper">
            <!-- æ’­æ”¾æœ¬åœ°æ–‡ä»¶ï¼šbeethoven.mp4 -->
            <video controls>
                <source src="videos/beethoven.mp4" type="video/mp4">
                è¯·å°† 'beethoven.mp4' æ”¾å…¥åŒä¸€æ–‡ä»¶å¤¹ä»¥æ’­æ”¾è§†é¢‘
            </video>
        </div>
    </div>
</main>

<script>
    // --- éŸ³é¢‘å¼•æ“ ---
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    function playNote(freq, type, duration, vol=0.5, startTime=0) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime + startTime);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime + startTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + startTime + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start(audioCtx.currentTime + startTime);
        osc.stop(audioCtx.currentTime + startTime + duration);
    }

    // --- å…¨å±€æ§åˆ¶ ---
    function switchScene(id) {
        document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
        document.getElementById('scene-' + id).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        document.querySelectorAll('video').forEach(v => v.pause()); // åˆ‡æ¢æ—¶æš‚åœè§†é¢‘
    }

    // --- æµ·é¡¿é€»è¾‘ ---
    let haydnEnergy = 0;
    
    function tapSoftly() {
        playNote(440 + Math.random()*100, 'sine', 0.2, 0.1); 
        haydnEnergy += 20;
        document.getElementById('haydn-meter').style.width = haydnEnergy + '%';
        const audience = document.querySelectorAll('.audience');
        audience.forEach(a => {
            a.style.transform = `rotate(${Math.random()*10 - 5}deg)`;
            a.textContent = 'ğŸ˜´';
            a.classList.remove('awake');
        });
        if(haydnEnergy >= 100) {
            document.getElementById('surprise-btn').classList.add('ready');
            document.getElementById('surprise-btn').disabled = false;
        }
    }

    function triggerSurprise() {
        if(haydnEnergy < 100) return;
        playNote(196, 'sawtooth', 1.0, 1.0);
        playNote(246.9, 'sawtooth', 1.0, 1.0);
        playNote(293.7, 'sawtooth', 1.0, 1.0);
        playNote(392, 'sawtooth', 1.0, 1.0);
        document.querySelectorAll('.audience').forEach(a => {
            a.textContent = 'ğŸ˜³';
            a.classList.add('awake');
        });
        haydnEnergy = 0;
        document.getElementById('haydn-meter').style.width = '0%';
        document.getElementById('surprise-btn').classList.remove('ready');
        document.getElementById('surprise-btn').disabled = true;
    }

    // --- è«æ‰ç‰¹é€»è¾‘ ---
    let outfit = { shoes: false, mask: false, crown: false };

    function toggleOutfit(item) {
        outfit[item] = !outfit[item];
        const btn = document.getElementById('item-' + item);
        const accessory = document.getElementById('acc-' + item);
        if(outfit[item]) {
            btn.classList.add('equipped');
            accessory.classList.add('visible');
        } else {
            btn.classList.remove('equipped');
            accessory.classList.remove('visible');
        }
        playMozartVariation();
    }

    function playMozartVariation() {
        let type = 'sine';
        let speed = 0.4;
        let notes = []; 
        
        if(outfit.mask) { 
            document.getElementById('main-star').style.filter = 'grayscale(100%)';
            document.getElementById('main-star').textContent = 'ğŸ’§';
            type = 'triangle'; 
            speed = 0.6; 
            notes = [{f: 523.25, d: 0.5}, {f: 622.25, d: 0.5}, {f: 783.99, d: 0.5}, {f: 622.25, d: 0.5}, {f: 523.25, d: 1.0}, {f: 261.63, d: 2.0, t: 0}];
        } else { 
            document.getElementById('main-star').style.filter = 'none';
            document.getElementById('main-star').textContent = 'â­';
            if(outfit.shoes) { 
                speed = 0.15; type = 'square'; 
                notes = [{f: 523, d: 0.1}, {f: 587, d: 0.1}, {f: 659, d: 0.1}, {f: 698, d: 0.1}, {f: 783, d: 0.1}, {f: 880, d: 0.1}, {f: 783, d: 0.3}];
            } else if (outfit.crown) { 
                speed = 0.3; type = 'sawtooth';
                notes = [{f: 523, d: 0.2}, {f: 587, d: 0.1}, {f: 523, d: 0.1}, {f: 783, d: 0.2}, {f: 880, d: 0.1}, {f: 783, d: 0.4}];
            } else { 
                notes = [{f: 523.25, d: 0.3}, {f: 523.25, d: 0.3}, {f: 783.99, d: 0.3}, {f: 783.99, d: 0.3}, {f: 880.00, d: 0.3}, {f: 880.00, d: 0.3}, {f: 783.99, d: 0.6}];
            }
        }
        let now = 0;
        notes.forEach((n) => {
            let startTime = (n.t !== undefined) ? n.t : now;
            playNote(n.f, type, n.d, 0.3, startTime);
            if(n.t === undefined) now += (n.d * (outfit.mask ? 1.2 : 0.8)); 
        });
    }

    // --- è´å¤šèŠ¬é€»è¾‘ ---
    let tapCount = 0;
    function tapDoor() {
        tapCount++;
        const door = document.querySelector('.door-inner');
        door.style.transform = 'scale(0.95)';
        setTimeout(() => door.style.transform = 'scale(1)', 100);

        if (tapCount < 4) {
            playNote(392, 'square', 0.2, 0.5);
            document.getElementById('light-' + tapCount).classList.add('on');
        } else if (tapCount === 4) {
            playNote(311.1, 'square', 1.5, 0.8); 
            document.getElementById('light-4').classList.add('on');
            document.querySelectorAll('.light').forEach(l => l.classList.add('success'));
            document.getElementById('lion').style.display = 'block';
            setTimeout(resetDoor, 3000);
        }
    }
    function resetDoor() {
        tapCount = 0;
        document.querySelectorAll('.light').forEach(l => {
            l.classList.remove('on');
            l.classList.remove('success');
        });
        document.getElementById('lion').style.display = 'none';
    }
</script>

</body>
</html>